<div class="p-3 content" th:fragment="dashboard">
    <div class="row">
        <div class="col">
            <div class="card border-success shadow h-100">
                <div class="card-body">
                    <h6 class="card-title text-success">
                        <i class="bi bi-box-arrow-in-down"></i>
                        <span th:text="${@textConstant.barangMasuk}"></span>
                    </h6>

                    <div class="d-block small">
                        <small th:text="${@textConstant.totalBeratKg + ' :'}"></small>
                        <strong th:text="${dataTransaksiMasuk.totalBerat.intValue() + ' Kg'}"></strong>
                    </div>

                    <div class="d-block small">
                        <small th:text="${@textConstant.totalHarga + ' :'}"></small>
                        <strong
                            th:text="${'Rp' + #numbers.formatInteger(dataTransaksiMasuk.totalHarga, 0, 'POINT')}"></strong>
                    </div>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card border-warning shadow h-100">
                <div class="card-body">
                    <h6 class="card-title text-warning">
                        <i class="bi bi-cash"></i>
                        <span th:text="${@textConstant.totalModal}"></span>
                    </h6>

                    <div class="d-block small">
                        <small th:text="${@textConstant.jumlah + ' :'}"></small>
                        <strong th:text="${'Rp' + #numbers.formatInteger(dataModal.totalModal, 0, 'POINT')}"></strong>
                    </div>
                </div>
            </div>
        </div>

        <th:block th:if="${pengguna.role.name() == 'ADMIN'}">
            <div class="col">
                <div class="card border-info shadow h-100">
                    <div class="card-body">
                        <h6 class="card-title text-info">
                            <i class="bi bi-people"></i>
                            <span th:text="${@textConstant.anakBuah}"></span>
                        </h6>

                        <div class="d-block small">
                            <small th:text="${@textConstant.terdaftar + ' :'}"></small>
                            <strong
                                th:text="${dataAnakBuah.totalAnakBuah.intValue() + ' ' + @textConstant.orang}"></strong>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="card border-danger shadow h-100">
                    <div class="card-body">
                        <h6 class="card-title text-danger">
                            <i class="bi bi-box-arrow-up"></i>
                            <span th:text="${@textConstant.barangKeluar}"></span>
                        </h6>

                        <div class="d-block small">
                            <small th:text="${@textConstant.totalBeratKg + ' :'}"></small>
                            <strong
                                th:text="${#numbers.formatInteger(dataTransaksiKeluar.totalBerat, 0, 'POINT') + ' Kg'}"></strong>
                        </div>

                        <div class="d-block small">
                            <small th:text="${@textConstant.totalHarga + ' :'}"></small>
                            <strong
                                th:text="${'Rp' + #numbers.formatInteger(dataTransaksiKeluar.totalHarga, 0, 'POINT')}"></strong>
                        </div>
                    </div>
                </div>
            </div>
        </th:block>
    </div>

    <div class="row mt-3">
        <div class="col">
            <div class="card border-black shadow h-100">
                <div class="card-body">
                    <h6 class="card-title text-black">
                        <i class="bi bi-trophy"></i>
                        <span th:text="${@textConstant.sawTransaksiMasuk}"></span>
                    </h6>
                    <canvas id="sawTransaksiMasuk" th:data-value="${@parse.toJSON(sawTransaksiMasuk)}"></canvas>
                </div>
            </div>
        </div>

        <th:block th:if="${pengguna.role.name() == 'ADMIN'}">
            <div class="col">
                <div class="card border-black shadow h-100">
                    <div class="card-body">
                        <h6 class="card-title text-black">
                            <i class="bi bi-trophy"></i>
                            <span th:text="${@textConstant.sawTransaksiKeluar}"></span>
                        </h6>
                        <canvas id="sawTransaksiKeluar" th:data-value="${@parse.toJSON(sawTransaksiKeluar)}"></canvas>
                    </div>
                </div>
            </div>
        </th:block>
    </div>





    <div class="card border-black my-4">

        <!-- Tabs -->
        <ul class="nav nav-tabs" id="sawTab" role="tablist">
            <li class="nav-item" role="presentation" th:if="${pengguna.role.name() == 'ADMIN'}">
                <button class="nav-link active" id="masuk-tab" data-bs-toggle="tab" data-bs-target="#masuk"
                    type="button" role="tab">
                    Transaksi Masuk
                </button>
            </li>
            <li class="nav-item" role="presentation" th:if="${pengguna.role.name() == 'ADMIN'}">
                <button class="nav-link" id="keluar-tab" data-bs-toggle="tab" data-bs-target="#keluar" type="button"
                    role="tab">
                    Transaksi Keluar
                </button>
            </li>
        </ul>

        <div class="tab-content mt-3 mx-3" id="sawTabContent">
            <!-- Transaksi Masuk -->
            <div class="tab-pane fade show active" id="masuk" role="tabpanel">
                <div th:with="sawData=${sawTransaksiMasukFull}">
                    <div th:insert="~{this ::sawBlock(${sawData})}"></div>
                </div>
            </div>

            <!-- Transaksi Keluar -->
            <div class="tab-pane fade" id="keluar" role="tabpanel" th:if="${pengguna.role.name() == 'ADMIN'}">
                <div th:with="sawData=${sawTransaksiKeluarFull}">
                    <div th:insert="~{this ::sawBlock(${sawData})}"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- FRAGMENT: SAW Block -->
    <th:block th:fragment="sawBlock(sawData)">
        <th:block th:if="${sawData != null}">
            <!-- 1. Bobot Kriteria -->
            <div class="card mt-3 mb-4 shadow-sm border-secondary">
                <div class="card-header bg-success text-white fw-bold small">
                    Langkah 1: Bobot Tiap Kriteria (W)
                </div>
                <div class="card-body">
                    <p class="text-muted small">Bobot ini ditentukan berdasarkan pentingnya kriteria dalam keputusan.
                        Jumlah
                        total bobot harus 1.</p>
                    <table class="table table-sm table-bordered text-center">
                        <thead class="table-light">
                            <tr>
                                <th>Kode</th>
                                <th>Nama Kriteria</th>
                                <th>Bobot</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>C1</td>
                                <td>Harga</td>
                                <td>0.50</td>
                            </tr>
                            <tr>
                                <td>C2</td>
                                <td>Volume</td>
                                <td>0.30</td>
                            </tr>
                            <tr>
                                <td>C3</td>
                                <td>Permintaan</td>
                                <td>0.20</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 2. Matriks Keputusan -->
            <div class="card mb-4 shadow-sm border-secondary">
                <div class="card-header bg-primary text-white fw-bold small">
                    Langkah 2: Matriks Keputusan (X)
                </div>
                <div class="card-body">
                    <p class="text-muted small">Matriks ini menunjukkan nilai awal untuk setiap alternatif terhadap tiap
                        kriteria.</p>
                    <table class="table table-sm table-bordered text-center">
                        <thead class="table-light">
                            <tr>
                                <th>Barang</th>
                                <th>C1 (Harga)</th>
                                <th>C2 (Volume)</th>
                                <th>C3 (Permintaan)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="entry : ${sawData.keputusan}">
                                <td th:text="${entry.key.namaBarang}">Barang</td>
                                <td th:text="${#numbers.formatDecimal(entry.value['harga'], 1, 2)}">0.00</td>
                                <td th:text="${#numbers.formatDecimal(entry.value['volume'], 1, 2)}">0.00</td>
                                <td th:text="${#numbers.formatDecimal(entry.value['permintaan'], 1, 2)}">0.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 3. Matriks Normalisasi -->
            <div class="card mb-4 shadow-sm border-secondary">
                <div class="card-header bg-warning text-dark fw-bold small">
                    Langkah 3: Matriks Normalisasi (R)
                </div>
                <div class="card-body">
                    <p class="text-muted small">Setiap nilai dibagi dengan nilai maksimum pada kolomnya, agar hasil
                        berada
                        di antara 0–1.</p>
                    <table class="table table-sm table-bordered text-center">
                        <thead class="table-light">
                            <tr>
                                <th>Barang</th>
                                <th>C1 (Harga)</th>
                                <th>C2 (Volume)</th>
                                <th>C3 (Permintaan)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="entry : ${sawData.normalisasi}">
                                <td th:text="${entry.key.namaBarang}">Barang</td>
                                <td th:text="${#numbers.formatDecimal(entry.value['harga'], 1, 2)}">0.00</td>
                                <td th:text="${#numbers.formatDecimal(entry.value['volume'], 1, 2)}">0.00</td>
                                <td th:text="${#numbers.formatDecimal(entry.value['permintaan'], 1, 2)}">0.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 4. Skor Akhir -->
            <div class="card mb-4 shadow-sm border-secondary">
                <div class="card-header bg-secondary text-white fw-bold small">
                    Langkah 4: Skor Akhir (R * W)
                </div>
                <div class="card-body">
                    <p class="text-muted small">Setiap nilai normalisasi dikalikan bobotnya lalu dijumlahkan untuk dapat
                        skor akhir.</p>
                    <table class="table table-sm table-bordered text-center">
                        <thead class="table-light">
                            <tr>
                                <th>Barang</th>
                                <th>Skor Akhir</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="s : ${sawData.skor}">
                                <td th:text="${s.barang}">Barang</td>
                                <td th:text="${#numbers.formatDecimal(s.skor, 1, 3)}">0.0000</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </th:block>
    </th:block>
</div>